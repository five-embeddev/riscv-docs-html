<html>
<head>
<link rel="stylesheet" href="../../assets/docs.css">
<title>The RISC-V Instruction Set Manual, Volume II: Privileged Architecture</title>
</head>
<body>

<table>
<tr><th colspan=2>Metadata Table</th></tr>
<tr><th>Manual Type</th><td> priv</td></tr>
<tr><th>Spec Revision</th><td> </td></tr>
<tr><th>Spec Release Date</th><td> </td></tr>
<tr><th>Git Revision</th><td> riscv-isa-release-1239329-2023-05-23-96-g1ee25e1</td></tr>
<tr><th>Git URL</th><td><a href=https://github.com/riscv/riscv-isa-manual.git>https://github.com/riscv/riscv-isa-manual.git</a></td></tr>
<tr><th>Source</th><td>src/priv-preface.adoc</td></tr>
<tr><th>Conversion Date</th><td>2023/11/12</td></tr>
<tr><th>License</th><td><a href=https://creativecommons.org/licenses/by/4.0/>CC-by-4.0</a></td></tr>
</table>

<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This document describes the RISC-V privileged architecture. This
release, version 20211203, contains the following versions of the RISC-V ISA
modules:</p>
</div>
<table class="tableblock frame-all grid-all fit-content center">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Module</th>
<th class="tableblock halign-left valign-top">Version</th>
<th class="tableblock halign-center valign-top">Status</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>Machine ISA</em><br>
<em>Smrnmi Extension</em><br>
<strong>Supervisor ISA</strong><br>
<strong>Svnapot Extension</strong><br>
<strong>Svpbmt Extension</strong><br>
<strong>Svinval Extension</strong><br>
<strong>Hypervisor ISA</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>1.13</em><br>
<em>0.1</em><br>
<strong>1.12</strong><br>
<strong>1.0</strong><br>
<strong>1.0</strong><br>
<strong>1.0</strong><br>
<strong>1.0</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>Draft</em><br>
<em>Draft</em><br>
<strong>Ratified</strong><br>
<strong>Ratified</strong><br>
<strong>Ratified</strong><br>
<strong>Ratified</strong><br>
<strong>Ratified</strong></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The following compatible changes have been made to the Machine ISA since
version 1.12:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Defined the <code>misa</code>.V field to reflect that the V extension has been
implemented.</p>
</li>
<li>
<p>Clarified semantics of explicit accesses to CSRs wider than XLEN bits.</p>
</li>
<li>
<p>Clarified that MXLEN&#8805;SXLEN, and added the constraint that
SXLEN&#8805;UXLEN.</p>
</li>
<li>
<p>Clarified that WFI is not a HINT instruction.</p>
</li>
<li>
<p>Clarified ordering rules when PBMT=IO is used on main-memory regions.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong class="big"><em>Preface to Version 20211203</em></strong></p>
</div>
<div class="paragraph">
<p>This document describes the RISC-V privileged architecture. This
release, version 20211203, contains the following versions of the RISC-V
ISA modules:</p>
</div>
<table class="tableblock frame-all grid-all fit-content center">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Module</th>
<th class="tableblock halign-left valign-top">Version</th>
<th class="tableblock halign-center valign-top">Status</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>Machine ISA</strong><br>
<strong>Supervisor ISA</strong><br>
<strong>Svnapot Extension</strong><br>
<strong>Svpbmt Extension</strong><br>
<strong>Svinval Extension</strong><br>
<strong>Hypervisor ISA</strong><br></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>1.12</strong><br>
<strong>1.12</strong><br>
<strong>1.0</strong><br>
<strong>1.0</strong><br>
<strong>1.0</strong><br>
<strong>1.0</strong><br></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>Ratified</strong><br>
<strong>Ratified</strong><br>
<strong>Ratified</strong><br>
<strong>Ratified</strong><br>
<strong>Ratified</strong><br>
<strong>Ratified</strong></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The following changes have been made since version 1.11, which, while
not strictly backwards compatible, are not anticipated to cause software
portability problems in practice:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Changed MRET and SRET to clear <code>mstatus</code>.MPRV when leaving M-mode.</p>
</li>
<li>
<p>Reserved additional <code>satp</code> patterns for future use.</p>
</li>
<li>
<p>Stated that the <code>scause</code> Exception Code field must implement bits 4–0
at minimum.</p>
</li>
<li>
<p>Relaxed I/O regions have been specified to follow RVWMO. The previous
specification implied that PPO rules other than fences and
acquire/release annotations did not apply.</p>
</li>
<li>
<p>Constrained the LR/SC reservation set size and shape when using
page-based virtual memory.</p>
</li>
<li>
<p>PMP changes require an SFENCE.VMA on any hart that implements
page-based virtual memory, even if VM is not currently enabled.</p>
</li>
<li>
<p>Allowed for speculative updates of page table entry A bits.</p>
</li>
<li>
<p>Clarify that if the address-translation algorithm non-speculatively
reaches a PTE in which a bit reserved for future standard use is set, a
page-fault exception must be raised.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Additionally, the following compatible changes have been made since
version 1.11:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Removed the N extension.</p>
</li>
<li>
<p>Defined the mandatory RV32-only CSR <code>mstatush</code>, which contains most of
the same fields as the upper 32 bits of RV64’s <code>mstatus</code>.</p>
</li>
<li>
<p>Defined the mandatory CSR <code>mconfigptr</code>, which if nonzero contains the
address of a configuration data structure.</p>
</li>
<li>
<p>Defined optional <code>mseccfg</code> and <code>mseccfgh</code> CSRs, which control the
machine’s security configuration.</p>
</li>
<li>
<p>Defined <code>menvcfg</code>, <code>henvcfg</code>, and <code>senvcfg</code> CSRs (and RV32-only
<code>menvcfgh</code> and <code>henvcfgh</code> CSRs), which control various characteristics
of the execution environment.</p>
</li>
<li>
<p>Designated part of SYSTEM major opcode for custom use.</p>
</li>
<li>
<p>Permitted the unconditional delegation of less-privileged interrupts.</p>
</li>
<li>
<p>Added optional big-endian and bi-endian support.</p>
</li>
<li>
<p>Made priority of load/store/AMO address-misaligned exceptions
implementation-defined relative to load/store/AMO page-fault and
access-fault exceptions.</p>
</li>
<li>
<p>PMP reset values are now platform-defined.</p>
</li>
<li>
<p>An additional 48 optional PMP registers have been defined.</p>
</li>
<li>
<p>Slightly relaxed the atomicity requirement for A and D bit updates
performed by the implementation.</p>
</li>
<li>
<p>Clarify the architectural behavior of address-translation caches</p>
</li>
<li>
<p>Added Sv57 and Sv57x4 address translation modes.</p>
</li>
<li>
<p>Software breakpoint exceptions are permitted to write either 0 or the
<code>pc</code> to <code><em>x</em>tval</code>.</p>
</li>
<li>
<p>Clarified that bare S-mode need not support the SFENCE.VMA
instruction.</p>
</li>
<li>
<p>Specified relaxed constraints for implicit reads of non-idempotent
regions.</p>
</li>
<li>
<p>Added the Svnapot Standard Extension, along with the N bit in Sv39,
Sv48, and Sv57 PTEs.</p>
</li>
<li>
<p>Added the Svpbmt Standard Extension, along with the PBMT bits in Sv39,
Sv48, and Sv57 PTEs.</p>
</li>
<li>
<p>Added the Svinval Standard Extension and associated instructions.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Finally, the hypervisor architecture proposal has been extensively
revised.</p>
</div>
<div class="paragraph">
<p><strong class="big"><em>Preface to Version 1.11</em></strong></p>
</div>
<div class="paragraph">
<p>This is version 1.11 of the RISC-V privileged architecture. The document
contains the following versions of the RISC-V ISA modules:</p>
</div>
<table class="tableblock frame-all grid-all fit-content center">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Module</th>
<th class="tableblock halign-left valign-top">Version</th>
<th class="tableblock halign-center valign-top">Status</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>Machine ISA</strong><br>
<strong>Supervisor ISA</strong><br>
<em>Hypervisor ISA</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>1.11</strong><br>
<strong>1.11</strong><br>
<em>0.3</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>Ratified</strong><br>
<strong>Ratified</strong><br>
<em>Draft</em></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Changes from version 1.10 include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Moved Machine and Supervisor spec to <strong>Ratified</strong> status.</p>
</li>
<li>
<p>Improvements to the description and commentary.</p>
</li>
<li>
<p>Added a draft proposal for a hypervisor extension.</p>
</li>
<li>
<p>Specified which interrupt sources are reserved for standard use.</p>
</li>
<li>
<p>Allocated some synchronous exception causes for custom use.</p>
</li>
<li>
<p>Specified the priority ordering of synchronous exceptions.</p>
</li>
<li>
<p>Added specification that xRET instructions may, but are not required
to, clear LR reservations if A extension present.</p>
</li>
<li>
<p>The virtual-memory system no longer permits supervisor mode to execute
instructions from user pages, regardless of the SUM setting.</p>
</li>
<li>
<p>Clarified that ASIDs are private to a hart, and added commentary about
the possibility of a future global-ASID extension.</p>
</li>
<li>
<p>SFENCE.VMA semantics have been clarified.</p>
</li>
<li>
<p>Made the <code>mstatus</code>.MPP field <strong>WARL</strong>, rather than <strong>WLRL</strong>.</p>
</li>
<li>
<p>Made the unused <code><em>x</em>ip</code> fields <strong>WPRI</strong>, rather than <strong>WIRI</strong>.</p>
</li>
<li>
<p>Made the unused <code>misa</code> fields <strong>WARL</strong>, rather than <strong>WIRI</strong>.</p>
</li>
<li>
<p>Made the unused <code>pmpaddr</code> and <code>pmpcfg</code> fields <strong>WARL</strong>, rather than <strong>WIRI</strong>.</p>
</li>
<li>
<p>Required all harts in a system to employ the same PTE-update scheme as
each other.</p>
</li>
<li>
<p>Rectified an editing error that misdescribed the mechanism by which
<code>mstatus.<em>x</em>IE</code> is written upon an exception.</p>
</li>
<li>
<p>Described scheme for emulating misaligned AMOs.</p>
</li>
<li>
<p>Specified the behavior of the <code>misa</code> and <code><em>x</em>epc</code> registers in systems
with variable IALIGN.</p>
</li>
<li>
<p>Specified the behavior of writing self-contradictory values to the
<code>misa</code> register.</p>
</li>
<li>
<p>Defined the <code>mcountinhibit</code> CSR, which stops performance counters from
incrementing to reduce energy consumption.</p>
</li>
<li>
<p>Specified semantics for PMP regions coarser than four bytes.</p>
</li>
<li>
<p>Specified contents of CSRs across XLEN modification.</p>
</li>
<li>
<p>Moved PLIC chapter into its own document.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong class="big"><em>Preface to Version 1.10</em></strong></p>
</div>
<div class="paragraph">
<p>This is version 1.10 of the RISC-V privileged architecture proposal.
Changes from version 1.9.1 include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The previous version of this document was released under a Creative
Commons Attribution 4.0 International License by the original authors,
and this and future versions of this document will be released under the
same license.</p>
</li>
<li>
<p>The explicit convention on shadow CSR addresses has been removed to
reclaim CSR space. Shadow CSRs can still be added as needed.</p>
</li>
<li>
<p>The <code>mvendorid</code> register now contains the JEDEC code of the core
provider as opposed to a code supplied by the Foundation. This avoids
redundancy and offloads work from the Foundation.</p>
</li>
<li>
<p>The interrupt-enable stack discipline has been simplified.</p>
</li>
<li>
<p>An optional mechanism to change the base ISA used by supervisor and
user modes has been added to the <code>mstatus</code> CSR, and the field previously
called Base in <code>misa</code> has been renamed to <code>MXL</code> for consistency.</p>
</li>
<li>
<p>Clarified expected use of XS to summarize additional extension state
status fields in <code>mstatus</code>.</p>
</li>
<li>
<p>Optional vectored interrupt support has been added to the <code>mtvec</code> and
<code>stvec</code> CSRs.</p>
</li>
<li>
<p>The SEIP and UEIP bits in the <code>mip</code> CSR have been redefined to support
software injection of external interrupts.</p>
</li>
<li>
<p>The <code>mbadaddr</code> register has been subsumed by a more general <code>mtval</code>
register that can now capture bad instruction bits on an illegal
instruction fault to speed instruction emulation.</p>
</li>
<li>
<p>The machine-mode base-and-bounds translation and protection schemes
have been removed from the specification as part of moving the virtual
memory configuration to <code>sptbr</code> (now <code>satp</code>). Some of the motivation for
the base and bound schemes are now covered by the PMP registers, but
space remains available in <code>mstatus</code> to add these back at a later date
if deemed useful.</p>
</li>
<li>
<p>In systems with only M-mode, or with both M-mode and U-mode but
without U-mode trap support, the <code>medeleg</code> and <code>mideleg</code> registers now
do not exist, whereas previously they returned zero.</p>
</li>
<li>
<p>Virtual-memory page faults now have <code>mcause</code> values distinct from
physical-memory access faults. Page-fault exceptions can now be
delegated to S-mode without delegating exceptions generated by PMA and
PMP checks.</p>
</li>
<li>
<p>An optional physical-memory protection (PMP) scheme has been proposed.</p>
</li>
<li>
<p>The supervisor virtual memory configuration has been moved from the
<code>mstatus</code> register to the <code>sptbr</code> register. Accordingly, the <code>sptbr</code>
register has been renamed to <code>satp</code> (Supervisor Address Translation and
Protection) to reflect its broadened role.</p>
</li>
<li>
<p>The SFENCE.VM instruction has been removed in favor of the improved
SFENCE.VMA instruction.</p>
</li>
<li>
<p>The <code>mstatus</code> bit MXR has been exposed to S-mode via <code>sstatus</code>.</p>
</li>
<li>
<p>The polarity of the PUM bit in <code>sstatus</code> has been inverted to shorten
code sequences involving MXR. The bit has been renamed to SUM.</p>
</li>
<li>
<p>Hardware management of page-table entry Accessed and Dirty bits has
been made optional; simpler implementations may trap to software to set
them.</p>
</li>
<li>
<p>The counter-enable scheme has changed, so that S-mode can control
availability of counters to U-mode.</p>
</li>
<li>
<p>H-mode has been removed, as we are focusing on recursive
virtualization support in S-mode. The encoding space has been reserved
and may be repurposed at a later date.</p>
</li>
<li>
<p>A mechanism to improve virtualization performance by trapping S-mode
virtual-memory management operations has been added.</p>
</li>
<li>
<p>The Supervisor Binary Interface (SBI) chapter has been removed, so
that it can be maintained as a separate specification.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong class="big"><em>Preface to Version 1.9.1</em></strong></p>
</div>
<div class="paragraph">
<p>This is version 1.9.1 of the RISC-V privileged architecture proposal.
Changes from version 1.9 include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Numerous additions and improvements to the commentary sections.</p>
</li>
<li>
<p>Change configuration string proposal to be use a search process that
supports various formats including Device Tree String and flattened
Device Tree.</p>
</li>
<li>
<p>Made <code>misa</code> optionally writable to support modifying base and
supported ISA extensions. CSR address of <code>misa</code> changed.</p>
</li>
<li>
<p>Added description of debug mode and debug CSRs.</p>
</li>
<li>
<p>Added a hardware performance monitoring scheme. Simplified the
handling of existing hardware counters, removing privileged versions of
the counters and the corresponding delta registers.</p>
</li>
<li>
<p>Fixed description of SPIE in presence of user-level interrupts.</p>
</li>
</ul>
</div>
</div>
</div>

</body>
</html>