<html>
<head>
<link rel="stylesheet" href="../../assets/docs.css">
<title>RISC-V Instruction Set Manual, Volume I: RISC-V User-Level ISA</title>
</head>
<body>

<table>
<tr><th colspan=2>Metadata Table</th></tr>
<tr><th>Manual Type</th><td> user</td></tr>
<tr><th>Spec Revision</th><td> </td></tr>
<tr><th>Spec Release Date</th><td> </td></tr>
<tr><th>Git Revision</th><td> riscv-isa-release-1239329-2023-05-23-96-g1ee25e1</td></tr>
<tr><th>Git URL</th><td><a href=https://github.com/riscv/riscv-isa-manual.git>https://github.com/riscv/riscv-isa-manual.git</a></td></tr>
<tr><th>Source</th><td>src/zam-st-ext.adoc</td></tr>
<tr><th>Conversion Date</th><td>2023/11/12</td></tr>
<tr><th>License</th><td><a href=https://creativecommons.org/licenses/by/4.0/>CC-by-4.0</a></td></tr>
</table>

<div class="sect1">
<h2 id="zam">1. "Zam" Standard Extension for Misaligned Atomics, v0.1</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter defines the "Zam" extension, which extends the "A"
extension by standardizing support for misaligned atomic memory
operations (AMOs). On platforms implementing "Zam", misaligned AMOs
need only execute atomically with respect to other accesses (including
non-atomic loads and stores) to the same address and of the same size.
More precisely, execution environments implementing "Zam" are subject
to the following axiom:</p>
</div>
<div class="sect2">
<h3 id="misaligned">1.1. Atomicity Axiom for misaligned atomics</h3>
<div class="paragraph">
<p>If \(r\) and \(w\) are paired misaligned load and
store instructions from a hart \(h\) with the same address and
of the same size, then there can be no store instruction \(s\)
from a hart other than \(h\) with the same address and of the
same size as \(r\) and \(w\) such that a store
operation generated by \(s\) lies in between memory operations
generated by \(r\) and \(w\) in the global memory
order. Furthermore, there can be no load instruction \(l\)
from a hart other than \(h\) with the same address and of the
same size as \(r\) and \(w\) such that a load
operation generated by \(l\) lies between two memory
operations generated by \(r\) or by \(w\) in the
global memory order.</p>
</div>
<div class="paragraph">
<p>This restricted form of atomicity is intended to balance the needs of
applications which require support for misaligned atomics and the
ability of the implementation to actually provide the necessary degree
of atomicity.</p>
</div>
<div class="paragraph">
<p>Aligned instructions under "Zam" continue to behave as they normally
do under RVWMO.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><em>The intention of "Zam" is that it can be implemented in one of two
ways:</em></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><em>On hardware that natively supports atomic misaligned accesses to the
address and size in question (e.g., for misaligned accesses within a
single cache line): by simply following the same rules that would be
applied for aligned AMOs.</em></p>
</li>
<li>
<p><em>On hardware that does not natively support misaligned accesses to the
address and size in question: by trapping on all instructions (including
loads) with that address and size and executing them (via any number of
memory operations) inside a mutex that is a function of the given memory
address and access size. AMOs may be emulated by splitting them into
separate load and store operations, but all preserved program order
rules (e.g., incoming and outgoing syntactic dependencies) must behave
as if the AMO is still a single memory operation.</em></p>
</li>
</ol>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>

</body>
</html>