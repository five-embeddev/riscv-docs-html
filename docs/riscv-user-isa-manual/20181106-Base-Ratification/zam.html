<html>
<head>
<link rel="stylesheet" href="../../assets/docs.css">
<title>RISC-V Instruction Set Manual, Volume I: RISC-V User-Level ISA</title>
</head>
<body>

<table>
<tr><th colspan=2>Metadata Table</th></tr>
<tr><th>Manual Type</th><td> user</td></tr>
<tr><th>Spec Revision</th><td> 20181106-Base-Ratification</td></tr>
<tr><th>Spec Release Date</th><td> </td></tr>
<tr><th>Git Revision</th><td> 20181106-Base-Ratification</td></tr>
<tr><th>Git URL</th><td><a href=https://github.com/riscv/riscv-isa-manual.git>https://github.com/riscv/riscv-isa-manual.git</a></td></tr>
<tr><th>Source</th><td>src/zam.tex</td></tr>
<tr><th>Conversion Date</th><td>2023/11/12</td></tr>
<tr><th>License</th><td><a href=https://creativecommons.org/licenses/by/4.0/>CC-by-4.0</a></td></tr>
</table>


<section id="sec:zam" data-number="1">
<h1 data-number="22"><span class="header-section-number">22</span> “Zam” Standard Extension for Misaligned Atomics, v0.1</h1>
<p>This chapter defines the “Zam” extension, which extends the “A” extension by standardizing support for misaligned atomic memory operations (AMOs).
On platforms implementing “Zam”, misaligned AMOs need only execute atomically with respect
to other accesses (including non-atomic loads and stores) to the same address and of the same size.
More precisely, execution environments implementing “Zam” are subject to the following axiom:</p>
<section id="rvwmo:ax:misaligned" data-number="1.0.0.0.1">
<h5 data-number="22.0.0.0.1"><span class="header-section-number">22.0.0.0.1</span> Atomicity Axiom for misaligned atomics</h5>
<p>If <span class="math inline"><em>r</em></span> and <span class="math inline"><em>w</em></span> are paired misaligned load and store instructions from a hart <span class="math inline"><em>h</em></span> with the same address and of the same size, then there can be no store instruction <span class="math inline"><em>s</em></span> from a hart other than <span class="math inline"><em>h</em></span> with the same address and of the same size as <span class="math inline"><em>r</em></span> and <span class="math inline"><em>w</em></span> such that a store operation generated by <span class="math inline"><em>s</em></span> lies in between memory operations generated by <span class="math inline"><em>r</em></span> and <span class="math inline"><em>w</em></span> in the global memory order. Furthermore, there can be no load instruction <span class="math inline"><em>l</em></span> from a hart other than <span class="math inline"><em>h</em></span> with the same address and of the same size as <span class="math inline"><em>r</em></span> and <span class="math inline"><em>w</em></span> such that a load operation generated by <span class="math inline"><em>l</em></span> lies between two memory operations generated by <span class="math inline"><em>r</em></span> or by <span class="math inline"><em>w</em></span> in the global memory order.</p>
<p>This restricted form of atomicity is intended to balance the needs of applications which require support for misaligned atomics and the ability of the implementation to actually provide the necessary degree of atomicity.</p>
<p>Aligned instructions under “Zam” continue to behave as they normally do under RVWMO.</p>
<div class=commentary>
<p>The intention of “Zam” is that it can be implemented in one of two ways:</p>
<ol>
<li><p>On hardware that natively supports atomic misaligned accesses to the address and size in question (e.g., for misaligned accesses within a single cache line): by simply following the same rules that would be applied for aligned AMOs.</p></li>
<li><p>On hardware that does not natively support misaligned accesses to the address and size in question: by trapping on all instructions (including loads) with that address and size and executing them (via any number of memory operations) inside a mutex that is a function of the given memory address and access size. AMOs may be emulated by splitting them into separate load and store operations, but all preserved program order rules (e.g., incoming and outgoing syntactic dependencies) must behave as if the AMO is still a single memory operation.</p></li>
</ol>
</div>
</section>
</section>

</body>
</html>
